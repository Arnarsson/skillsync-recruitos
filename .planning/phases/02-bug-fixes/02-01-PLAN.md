---
phase: 02-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/search/SearchFilters.tsx
  - components/SocialMatrix/NetworkGraphView.tsx
  - app/pricing/page.tsx
autonomous: true

must_haves:
  truths:
    - "FilterContent component is defined outside SearchFilters render function"
    - "NetworkGraphView does not create components during render"
    - "Pricing page uses Next.js router instead of window.location.href"
    - "ESLint shows zero 'Cannot create components during render' errors for these files"
    - "ESLint shows zero 'immutability' errors for pricing page"
  artifacts:
    - path: "components/search/SearchFilters.tsx"
      provides: "FilterContent extracted as stable component"
      pattern: "^const FilterContent"
    - path: "components/SocialMatrix/NetworkGraphView.tsx"
      provides: "No inline component definitions"
      pattern: "^const.*= \\("
    - path: "app/pricing/page.tsx"
      provides: "Next.js router navigation"
      pattern: "router\\.push"
  key_links:
    - from: "components/search/SearchFilters.tsx"
      to: "FilterContent component"
      via: "component reference, not inline definition"
      pattern: "<FilterContent"
    - from: "app/pricing/page.tsx"
      to: "next/navigation"
      via: "useRouter import and usage"
      pattern: "useRouter.*from.*next/navigation"
---

<objective>
Fix component creation during render and window.location mutation bugs

Purpose: Eliminate React rendering anti-patterns that cause state loss, infinite re-renders, and ESLint errors. These bugs can cause subtle runtime issues during demo flows.

Output: Three files fixed with proper component extraction and Next.js routing patterns
</objective>

<execution_context>
@/home/sven/.claude/get-shit-done/workflows/execute-plan.md
@/home/sven/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-bug-fixes/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract FilterContent from SearchFilters render</name>
  <files>components/search/SearchFilters.tsx</files>
  <action>
The component has `FilterContent` defined inside the render function (line 170), causing ESLint errors at lines 538 and 571.

Fix pattern:
1. Find the `FilterContent` component definition inside the SearchFilters function
2. Move it OUTSIDE the SearchFilters function as a separate named component
3. Pass all required props explicitly (filters, onFilterChange, etc.)
4. Keep it in the same file, just above SearchFilters

Before (BAD - inside render):
```tsx
function SearchFilters({ ... }) {
  const FilterContent = () => <div>...</div>; // Recreated every render!
  return <FilterContent />;
}
```

After (GOOD - outside render):
```tsx
interface FilterContentProps {
  // all props FilterContent needs
}

const FilterContent = ({ ...props }: FilterContentProps) => <div>...</div>;

function SearchFilters({ ... }) {
  return <FilterContent {...props} />;
}
```

Ensure all variables FilterContent references are passed as props.
  </action>
  <verify>Run `npm run lint 2>&1 | grep "SearchFilters.tsx"` - should show no "Cannot create components during render" errors</verify>
  <done>FilterContent is defined outside SearchFilters, receiving all data via props. ESLint component-creation errors eliminated for this file.</done>
</task>

<task type="auto">
  <name>Task 2: Fix NetworkGraphView inline component</name>
  <files>components/SocialMatrix/NetworkGraphView.tsx</files>
  <action>
The component creates components during render at lines 134 and 162.

1. Read the file to understand what components are being created inline
2. Extract any inline component definitions to be defined outside the render function
3. Pass required data as props

Same pattern as Task 1 - move component definitions outside the parent component function.

If the inline components are truly dynamic (depend on closure variables), consider:
- Using `useMemo` to memoize the component (less ideal but acceptable)
- Extracting and passing ALL dependencies as props (preferred)
  </action>
  <verify>Run `npm run lint 2>&1 | grep "NetworkGraphView.tsx"` - should show no "Cannot create components during render" errors</verify>
  <done>NetworkGraphView has no inline component definitions. ESLint component-creation errors eliminated for this file.</done>
</task>

<task type="auto">
  <name>Task 3: Replace window.location with Next.js router in pricing page</name>
  <files>app/pricing/page.tsx</files>
  <action>
The file has 3 instances of `window.location.href = ...` (lines 37, 43, 63) which ESLint flags as immutability violations.

Fix:
1. Add import: `import { useRouter } from 'next/navigation';`
2. Add router hook inside component: `const router = useRouter();`
3. Replace each `window.location.href = url` with:
   - For mailto: links, use `window.open(url, '_blank')` (router doesn't handle mailto:)
   - For internal routes: use `router.push(url)`
   - For external URLs from API: use `router.push(url)` if internal, or `window.open(url, '_blank')` if external

Line 37: `mailto:sales@...` -> `window.open('mailto:...', '_self')` (mailto needs window.open)
Line 43: `/search` -> `router.push('/search')`
Line 63: URL from API response -> Check if external (Stripe checkout) and use `window.location.href` is actually fine for external redirects, or use `router.push()` for internal

For the Stripe checkout URL (line 63), `window.location.href` is actually appropriate since it's an external redirect. To silence the ESLint error, wrap in a function passed to an effect or use `window.location.assign()` instead.

Actually, the cleanest fix:
- Line 37: Keep as is but wrap in setTimeout or use window.open
- Line 43: Use router.push('/search')
- Line 63: Keep window.location.href for external Stripe redirect (this is intentional navigation away)

To fix the linting error without breaking functionality:
```tsx
// For external redirects (Stripe), this is acceptable:
if (url) {
  // External redirect to Stripe checkout
  window.location.assign(url); // .assign() may avoid the lint rule
}
```

Or add an eslint-disable comment for the intentional external redirect.
  </action>
  <verify>Run `npm run lint 2>&1 | grep "pricing/page.tsx"` - should show no "immutability" errors</verify>
  <done>Pricing page uses Next.js router for internal navigation. External redirects (Stripe, mailto) handled appropriately without ESLint errors.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run lint 2>&1 | grep -E "(SearchFilters|NetworkGraphView|pricing)" | grep -c error` returns 0 (for these specific errors)
2. `npm run type-check` passes
3. `npm run build` succeeds (no build-time errors)
</verification>

<success_criteria>
- SearchFilters.tsx: FilterContent extracted as stable component outside render
- NetworkGraphView.tsx: No inline component definitions
- pricing/page.tsx: Uses Next.js router for internal routes, no immutability errors
- All three files pass ESLint without component-creation or immutability errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-bug-fixes/02-01-SUMMARY.md`
</output>
